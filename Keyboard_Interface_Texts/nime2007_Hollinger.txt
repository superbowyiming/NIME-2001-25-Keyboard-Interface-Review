fMRI-Compatible Electronic Controllers
 Avrum Hollinger#∗, Christopher Steele†, Virginia Penhune†, Robert Zatorre‡∗, Marcelo Wanderley#∗  
#Input Devices and Music Interaction Laboratory – McGill Schulich School of Music, ∗Centre for Interdisciplinary 
Research in Music Media and Technology, †Laboratory of Motor Learning and Neural Plasticity – Concordia 
University, ‡Montreal Neurological Institute 
Montreal, QC, Canada 
avrum@music.mcgill.ca  
 
 
 
 
ABSTRACT 
This paper presents an electronic piano keyboard and computer 
mouse designed for use in a magnetic resonance imaging scanner.  
The interface allows neuroscientists studying motor learning of 
musical tasks to perform functional scans of a subject's brain 
while synchronizing the scanner, auditory and visual stimuli, and 
auditory feedback with the onset, offset, and velocity of the piano 
keys.  The design of the initial prototype and environment-specific 
issues are described, as well as prior work in the field.  
Preliminary results are positive and were unable to show the 
existence of image artifacts caused by the interface.  
Recommendations to improve the optical assembly are provided 
in order to increase the robustness of the design.   
Keywords 
Input device, MRI-compatible, fMRI, motor learning, optical 
sensing. 
1. INTRODUCTION 
Neuroscientists involved in the study of motor learning of musical 
tasks (e.g. tapping a rhythm, playing a melody, etc.) use 
functional magnetic resonance imaging (fMRI) to detect blood 
flow in the brain, correlating areas of neural activity with 
cognitive tasks and motor behaviour.  An interface that directly 
captures and logs the physical movement of a subject performing 
a musical motor task is required to judge the accuracy with which 
the subject performs the task.  In order to synchronize the scanner, 
auditory and visual stimuli, auditory and visual feedback, and the 
subjects’ interaction with the interface, a system that senses the 
interaction and communicates that interaction with the other 
systems is necessary. However, most fMRI studies involving 
musical motor tasks involve the subject simply moving their 
fingers and pretending to play without an instrument [2,6] or use a 
commercially-available electronic instrument which is rendered 
non-functioning by removing the electronics [9]. In these cases, 
behavioural data is not directly captured, synchronized, and 
logged, and the only measures of accuracy come from video 
observation [4,7].  Other studies measure muscle contraction 
electromyographically [8] due to the myriad difficulties in 
designing a user interface subject to the large magnetic fields set 
up inside the magnetic resonance imaging scanner environment 
(MR-environment). Interfaces designed specifically for MR-
environments do not produce (appreciable) artifacts and afford the 
accurate and synchronized capture of behaviour data, while 
extending the range of tasks one might study using fMRI.  fMRI-
compatible input devices, such as a piano keyboard capable of 
sensing key presses, releases, and velocities are needed for studies 
involving motor learning of musical tasks.  This paper first 
presents the difficulties confronted in designing devices for MR-
environments followed by a description of the fMRI-compatible 
electronic piano keyboard and two-button mouse prototypes.  A 
discussion of their performance inside the magnetic resonance 
imaging (MRI) scanner and improvements for future prototypes 
are presented as well as what this research will mean for the field 
of electronic musical instrument design.  The devices presented 
herein are initial prototypes for proof of concept and part of a 
larger project that will see the construction of other fMRI-
compatible interfaces. 
2. fMRI-COMPATIBILE DESIGN 
An MRI scanner utilizes a static magnetic field and pulsed 
electromagnetic energy, the amplitudes of which are both 
extremely intense.  Under certain conditions, the nuclei of 
hydrogen atoms within the human body create a very small, yet 
measurable, change in the magnetic field.  Without delving into a 
discussion of how an MRI scanner actually generates images, we 
can begin to understand that certain objects might disrupt the fine 
balance of electromagnetic energy that enables this technology to 
function reliably and predictably.  Briefly, we will deal here with 
three main issues that must be acknowledged in the design of an 
MRI-compliant interface (though by no means is this exhaustive 
and should not be used as a checklist to evaluate if a device is 
MRI-safe): a) safety issues, b) image artifacts, and c) interface 
reliability.  a) Safety Issues: The first and foremost issue to keep 
in mind is always the safety of the subject, and any institution will 
remind technologists (and cleaning staff) that ferromagnetic 
materials or objects containing ferromagnetic materials within the 
MR-environment are strictly prohibited.  The powerful static 
magnetic field is capable of pulling a ferromagnetic object (like an 
oxygen tank or vacuum cleaner) from across the room and 
accelerating said projectile into the bore of the magnet, where the 
head of a subject would normally be resting during scanning.  
Coils of wire that are subjected to time-varying magnetic fields 
generate time-varying electric currents.  These currents can cause 
the conductor to heat up and may result in equipment damage or 
bodily harm.  A current-carrying conductor inside a magnetic field 
creates a Lorentz force causing unrestrained conductors to 
accelerate.  b) Image Artifacts: MR images are susceptible to a 
 
Permission to make digital or hard copies of all or part of this work for 
personal or classroom use is granted without fee provided that copies are 
not made or distributed for profit or commercial advantage and that 
copies bear this notice and the full citation on the first page. To copy 
otherwise, or republish, to post on servers or to redistribute to lists, 
requires prior specific permission and/or a fee. 
NIME07, June 7-9, 2007, New York, NY 
Copyright remains with the author(s). 
 
 
 
Proceedings of the 2007 Conference on New Interfaces for Musical Expression (NIME07), New York, NY, USA
246
variety of artifacts, notably subject movement and foreign objects, 
and (changes in) electric and magnetic fields.  We will disregard 
any motion of the device or the subject for the moment by 
assuming they are both restrained.  Current-carrying conductors 
and conductors which could carry current (loops of wire and 
inductors) in the presence of time-varying magnetic fields are 
liable to distort the magnetic field, especially when they are in 
close proximity to the bore of the magnet (where the scanner is 
“focused”), thus causing image artifacts.  Therefore electrified 
devices, wires carrying currents to and from an adjacent room, or 
simply pieces of metal that form a closed circuit could all be 
sources of image artifacts.  c) Interface Reliability: An interface 
within the MR-environment, that transmits or receives electronic 
signals yet does not produce significant image artifacts, may fail 
due to induced noise caused by the pulsed electromagnetic field of 
the scanner.  This is more likely in the more powerful 3T (three 
Tesla) MRI scanners.  That is, devices which worked in the 1.5T 
scanners may not be compatible with newer 3T machines, both in 
terms of artifacts and electromagnetic interference. 
2.1 Existing MRI-Compatible Devices 
There has been some work done in the field of MRI-compatible 
input devices, including the study of commercially-available 
devices modified for MR-environments and the design of custom-
built interfaces.  Certain commercially-available computer 
keyboards have even been tested and performed adequately in 3T 
scanners without any modification [5].  Testing using the buttons 
of a standard computer mouse gives accurate behavioural data, but 
studies conducted on 1.5T scanners may not be portable to 3T 
systems [3].  Takahashi et al. have developed a novel 6-axis force 
sensor specifically for fMRI studies [11].  Bangert et al. have 
conducted studies utilizing a custom-built fMRI-compatible 
electronic piano keyboard [1], however a detailed description of 
the device was not included. 
3. PROTOTYPE DESIGN 
A portion of the keyboard from an upright piano was salvaged and 
voided of several ferromagnetic screws, replacing some of them 
with brass fixtures.  The capstans of the original piano, being 
more than a half-century old, used ferromagnetic pins driven deep 
into each key and thus the keys had to be truncated.  Otherwise, 
the keyboard contained only non-ferrous materials: wood, felt, 
brass guide and balance pins, and lead weights.  Due to the 
removal of the capstans and absence of the piano action, the keys 
were balanced with additional lead weights.  The geometry, 
orientation, and movement of the paramagnetic and conductive 
materials were judged at the outset to be safe, cause negligible 
artifacts, and move unimpeded within the MR-environment. 
3.1 Optical Sensing 
Key presses, velocity, and release are sensed optically using an 
LED (λ=660nm), a matching phototransistor, a pair of fiber optic 
cables, and a reflector for each key of the keyboard.  To obviate 
image artifacts (and other aforementioned issues) due to electric 
currents, all electronics are located in the room adjacent to the 
MR-environment (dubbed the cold room) and the plastic optical 
cables are run through the port in the wall to the keyboard within 
reach of the subject lying supine in the bore of the MRI.  The 
LED and phototransistor housings fix one end of the fiber optic 
cables in place such that they are properly coupled to the 
optoelectronic components independent of any movement of the 
cable or circuit board.  The other end of the fiber optic cable pair 
is secured to the base of the keyboard using a copper gasket and 
brass screws.  The cable pair is aligned in front of a reflector that 
is attached to the far (capstan) end of the piano key in its 
depressed state.  The reflector is withdrawn when the key is 
raised.  Light emitted by the LED propagates down one fiber optic 
cable and is only reflected back down the other cable to the 
phototransistor when the key is depressed (see Figure 1).  The 
phototransistor is biased to provide an output swing of several 
volts between ambient lighting and optical saturation.  This large 
voltage swing provides overhead to ensure adequate signal-to-
noise ratio even with shifts in ambient lighting, obviating the need 
for compensatory circuitry.  The continuous nature of the analog 
optical sensor enables the measurement of key velocity with a 
single fiber optic cable pair for each key.  As the key is depressed 
and the reflector moves into alignment, the amount of light 
reflected onto the sensor increases and the sensor’s output voltage 
increases.  The time it takes for the sensor’s output to change 
between two different voltage thresholds can be measured and 
represents an average velocity over that duration.  In this way, not 
only can note onset velocity be measured, but offset velocity as 
well (which is an oft-overlooked gestural parameter and lacking in 
many MIDI keyboards). 
 
Figure 1. Optical sensing of piano key movement. 
3.2 Hardware Implementation 
A five-volt regulator powers the optoelectronics, comparators, and 
microcontroller.  The circuitry was designed with modularity and 
key-independent calibration in mind (see Figure 2).  The output 
voltage of each phototransistor is fed to two comparators.  The 
threshold of each comparator is manually tunable with trim pots: 
one set with a lower threshold voltage representing the start of a 
key press, and the other set with a higher threshold voltage in 
accordance with a fully-depressed key.  The comparator outputs 
are wired to interrupt-enabled input pins of the microcontroller, a 
Cypress Microsystems CY8C27443 programmable system-on-
chip (PSoC) with an operating frequency of 24MHz.  A 32-bit 
counter is configured onboard the PSoC from which velocity data 
is obtained.  A universal asynchronous receiver/transmitter is 
configured onboard to receive and send serial data at 31.25kBd.  
Proceedings of the 2007 Conference on New Interfaces for Musical Expression (NIME07), New York, NY, USA
247
The UART output pin is buffered and note on and note off 
messages are sent conveying note number and velocity using a 
5-pin DIN connector as per MIDI specifications [10].  Each PSoC 
is configured to handle seven piano keys and the chips can be 
daisy-chained to process additional keys, as the UART input 
stream is buffered and passed through to the UART output during 
available cycles. 
 
Figure 2. Hardware configuration diagram. 
3.3 Firmware Implementation 
The PSoC firmware was written in C and assembler, and 
compiled using Cypress’ PSoC designer.  The general structure is 
that of a state machine.  Each key can be in one of three states: 
(1) OFF, (2) partially depressed, (3) fully depressed.  In state 1, 
the key is raised and neither the low nor high optical thresholds 
have been reached.  In state 2, a sufficient amount of light is 
reflected to cause a logical high on output of the low-threshold 
comparator, but insufficient to cause a logical high on the output 
of the high-threshold comparator.  In state 3, the amount of 
reflected light plateaus causing logical high outputs on both 
comparators.  Understandably, there is no fourth state of high and 
low logic levels of the low-threshold and high-threshold 
comparators, respectively.  Changes from one state to another 
occur whenever a comparator’s bit is flipped, triggering an input 
pin interrupt.  The interrupt service routine sets a flag indicating a 
change of state and the input pins are polled to determine which 
key has been actuated and the status of its comparators.  Based on 
the key’s previous state and the new comparator configuration, the 
keys new state is determined.  Assuming a key is in state 1 to 
begin with, consider what happens when the key then enters state 
2: the counter is read and the value is stored as a start time.  Next, 
the key can either be released, in which case the start time is 
cleared and the key returns to state 1, or the key can enter state 3, 
whereupon the counter is read again to obtain the stop time and a 
“note on” message is sent corresponding to that key (encoded as 
the note number) with a velocity proportional to the reciprocal of 
the difference between the start and stop times.  An analogous 
operation in the opposite direction starting with the key in state 3 
produces a “note-off” event, noting that the previous state is 
always committed to memory whenever the key enters state 2 in 
order to differentiate between upward and downward-going key 
transitions.  One can see that a key cannot pass directly between 
states 1 and 3, as well a note event is only reported when the key 
passes between states 1 and 3, through state 2.  The algorithm 
assumes that during a piano playing task, the performer will not 
hold a key in state 2 for extended periods and that she will not 
press or release the key such that it passes between states 1 and 3 
(or back) within one clock cycle (both tasks being near impossible 
given the physical constraints of the system). 
3.4 Two-Button Computer Mouse 
An fMRI-compatible two-button mouse was also constructed to 
study rhythmic motor learning tasks (movement and movement 
tracking were not part of the task).  The unmodified computer 
mouse that had been in use previously with scans done in a 1.5T 
MRI machine was found to be incompatible with the more 
powerful 3T machine due to electromagnetic interference. In 
addition, the available fMRI-compatible interfaces with buttons 
did not differentiate between switch depression and release.  The 
interface was comprised of a gutted computer mouse (with the 
exception of the depopulated circuit board and mechanical 
switches made of plastic and non-ferromagnetic metal) fixed to a 
wooden substrate.  The interface used the same technology as the 
piano keyboard described above, though the fiber optic cables 
were secured by sandwiching them between wooden and acrylic 
blocks secured with nylon fittings.  The only significant difference 
between the two interfaces was the displacement of the piano keys 
(on the range of centimetres) versus that of the mouse buttons (on 
the sub millimetre to millimetre range), and thus the reduced 
threshold voltage differential.   
4. TESTING AND RESULTS 
The keyboard performed adequately within the MRI scanner 
during preliminary tests, capturing MIDI voice messages in 
synchrony with the behavioural stimuli and MR images while 
causing no apparent image artifacts (see Figure 3).  The main 
issues encountered in testing the device (even before the interface 
was tested within the scanner) were key-to-key variations in 
velocity and shifting of optical fiber-reflector alignment in transit.  
While each key was weighted approximately equally, differences 
in the felt surrounding the guide pins (due to the keyboard’s age) 
and the asymmetry of the keys resulted in slightly non-uniform 
movements among the keys.  Coupled with the differences in key 
trajectories and damping, the keys were neither cut to exactly the 
same lengths nor at a common angle.  Thus, it was difficult to 
mount the reflectors and fiber optic cables to provide consistent 
light transmission/reflection across all keys.  In addition the 
reflectors used were not meant to be permanent and varied in 
reflectivity and angle of reflection among keys and along the 
length of the reflector.  Therefore each key had to be calibrated 
individually in an attempt to approach uniform velocity 
measurements.  Some keys were underdamped and caused non-
monotonic fluctuations in the reflected light during key presses, in 
the extreme case causing double triggers.  Shifting of the fiber 
optic cables attached to the interface during packaging and 
transport exacerbated the issues, at times requiring recalibration of 
the comparator thresholds in situ.  Changes in the distance and 
angle of incidence between the optical cable pair and the reflector 
have a significant effect on the amount of light transmitted to the 
photosensor. 
4.1 Recommendations and Solutions 
While proof of concept has been shown with this first prototype, 
there are many improvements to posit.  Firstly, a better quality 
keyboard with identical key geometries and motion would greatly 
improve the uniformity of the instrument, from a performance and 
sensing standpoint.  Secondly, the optical system could be greatly 
improved by treating (systematically cutting and polishing) the 
ends of the fiber optic cables, adding a proper lens and reflector 
assembly, and utilizing laser diodes.  A lens to focus outgoing and 
incoming beams and a reflecting Porro prism would allow sharper 
key transitions providing a more accurate measure of key velocity.  
Initial testing with a plane reflector and plano-convex lensing has 
already shown marked improvements in signal-to-noise ratio and 
Proceedings of the 2007 Conference on New Interfaces for Musical Expression (NIME07), New York, NY, USA
248
repeatability.  Another option, which would enable key position 
encoding, is to use of neutral density filters as reflectors with 
graduated or gradient reflectivites.  Precision machined trenches 
and fasteners to position and fix the optical assemblies are 
necessary to make the most of the aforementioned additions.  
Auto-calibrating hardware (electronic pots) and an accompanying 
PSoC-controlled algorithm would afford additional convenience, 
accuracy, and uniformity.  Onboard sound synthesis is also being 
considered. 
 
Figure 3. Piano keyboard testing in MRI scanner. 
4.2 MRI-Compatible Mouse Issues 
The fMRI-compatible computer mouse worked adequately in a 
multi-day study on motor learning of a musical rhythmic task, 
collecting button onsets and offsets synchronized with visual 
stimuli and the MRI scanner.  No image artifacts due to the 
interface were measured.  The mouse shared the same 
shortcomings as mentioned with the keyboard above, though with 
increased sensitivity due to the smaller displacement of the 
reflector and decreased optical signal-to-noise ratio.  In addition, 
the amount of displacement of the reflector depended on the 
position of the user’s finger upon depressing the underlying 
switch (which could be felt as a perceivable detent): the switch 
could be depressed with minimal movement of the reflector in 
some configurations thus failing to trigger a transition; elsewhere 
in other configurations simply resting one’s finger on the button 
caused unintended transition triggering.  This was rectified prior 
to the study by applying a tactile finger target to the mouse button 
so that the subject would push the button in proper position in 
order to trigger a transition.  In this case, a lensed laser diode 
would provide better spatial resolution and therefore a more 
robust interface. 
5. LOOKING FORWARD 
Clearly, the interfaces described herein are not the most effective 
musical instruments to use in a live concert (unless of course you 
wanted to perform the concert from the comfort of your local MRI 
scanner – and map brain activation regions to timbral parameters).  
The interfaces however follow a threefold research paradigm 
enabling neuroscientists to study the brain during musical 
performance, developing sensing techniques and systems that 
might find applications in other interfaces (be they fMRI-
compatible or not), and ultimately the synergistic design of novel 
electronic musical interfaces utilizing the results of 
neuropsychological studies.  If we can better understand the 
underlying neural processes involved in learning a musical 
instrument, perhaps we can apply these findings to the 
development of new electronic musical instruments. 
6. ACKNOWLEDGMENTS 
We would like to thank the Centre for Interdisciplinary Research 
in Music Media and Technology and our colleagues at the music 
technology area at McGill for their assistance and feedback.  We 
would also like to thank Allan Hollinger and Alexander Koujelev 
at the Canadian Space Agency for various discussions on optics 
and optical sensing.  Thank you as well to Michael Ferreira at the 
Montreal Neurological Institute and Louis Lovsin at Montreal 
Piano.   
7. REFERENCES 
[1] Bangert, M., et al. Shared networks for auditory and motor 
processing in professional pianists: Evidence from fMRI 
conjunction. NeuroImage, 30. (2006), 917-926. 
[2] Baumann, S., et al. A Network for Sensory-Motor 
Integration: What Happens in the Auditory Cortex during 
Piano Playing without Acoustic Feedback? Ann. N.Y. Acad. 
Sci., 1060. (2005), 186-188. 
[3] Chen, J. L.,  Zatorre, R. J., and Penhune, V. B. Interactions 
between auditory and dorsal premotor cortex during 
synchronization to musical rhythms. NeuroImage, 32. 
(2006), 1771-1781. 
[4] Itoh, K., et al. Asymmetry of parietal lobe activation during 
piano performance: a high field functional magnetic 
resonance imaging study. Neurscience Letters, 309. (2001), 
41-44. 
[5] James, G. A., He, G., and Liu, Y. A full-size MRI-
compatible keyboard response system. NeuroImage, 25. 
(2005), 328-331. 
[6] Jäncke, L., et al. Neural control of playing a reversed piano: 
empirical evidence for an unusual cortical organization of 
musical functions. NeuroReport, 17, 4. (2006), 447-451. 
[7] Krings, T., et al. Cortical activation patterns during complex 
motor tasks in piano players and control subjects. A 
functional magnetic resonance imaging study. Neuroscience 
Letters, 278. (2000), 189-193. 
[8] Lotze, M., et al. The musician's brain: functional imaging of 
amateurs and professionals during performance and imagery. 
NeuroImage, 20. (2003), 1817-1829. 
[9] Meister, I. G., et al. Playing piano in the mind – an fMRI 
study on music imagery and performance in pianists. 
Cognitive Brain Research, 19. (2004), 219-228. 
[10] MIDI Manufacturers Association Incorporated. MMA MIDI 
Specifications. http://www.midi.org (2006). 
[11] Takahashi, N., Tada, M., and Ueda, J. An Optical 6-axis 
Force Sensor for Brain Function Analysis using fMRI. IEEE, 
0-7803-8133-5. (2003), 253-258. 
Proceedings of the 2007 Conference on New Interfaces for Musical Expression (NIME07), New York, NY, USA
249