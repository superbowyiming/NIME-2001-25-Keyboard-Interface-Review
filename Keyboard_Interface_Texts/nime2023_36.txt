A FLexible musical instrument Augmentation that is Programmable, Integrated in a Box (FLAPIBox)  
Erik Stifjell  UiT The Arctic University of Norway Academy of Music/ University of Bergen Faculty of Fine Art, Music and Design Tromso/Bergen, Norway erik.stifjell@uit.no    ABSTRACT Most musical instrument augmentations aim to only fit one specific instrument and depend on an external sound system to work as intended. In a more acoustic concert setting this often alienates the electronic sound component. The FLAPIBox is an integrated solution that fits most acoustic instruments and use its own resonance for playing electronic sound in a more organic way—through the instrument itself. Reviewing related works and exploring different hardware and software components, a modular prototype has been built. The results of this preliminary study make the body of planning and building the first integrated breadboard prototype. Because of its flexible design, the FLAPIBox can use several different microphone, and loudspeaker technologies. Using inexpensive components and developing open-source software, the FLAPIBox is both affordable and accessible. The development of the FLAPIBox aim to result in a stable and predictable platform, yet open and versatile enough for further development.   Author Keywords FLAPIBox, Instrument Augmentation, Feedback, Loudspeakers, Microphones, Prototyping CCS Concepts • Hardware~Communication hardware, interfaces and storage~Sound-based input / output • Applied computing~Arts and humanities~Sound and music computing. 1.INTRODUCTION Over the last decades instrumentalistst, composers, visual artists and luthiers have built new instruments or altered existing instruments to enhance their expression possibilities. These hyperinstruments, embedded instruments, augmented instruments, or Self-resonating Vibrotactile Feedback-instruments (SRIs) come in all shapes or forms, utilize the latest technology, and push the boundaries of how modern music instruments can sound. However, these high-tech innovations are often made for, or adapted to, specific instruments or instrumentalists, and are thus not easily accessible to everyone.  The author’s background as a composer seeking alternative ways of combining electronic and acoustic sounds in compositions is the main motivation for developing a universal 
 1 https://github.com/erikstifjell/FLAPIBox 
device for augmenting any instrument. The FLAPIBox is an ongoing development of a musical instrument augmentation. The goal is to create a portable device with the option of replaceable hardware peripherals and an open library of interchangeable software modules available in an online repository1, all to fit different instrumental and compositional requirements. The development is in its early stage and the first breadboard prototype has already been built. The FLAPIBox also offers an improved way of playing electronic sound other than placing a number of loudspeaker boxes in a room. All acoustic instruments have some kind of resonance that can be utilized for amplifying an electronic sound signal, similar to how the same resonance amplifies the sound generated by the instrument itself. By applying the right loudspeaker technology electronic sound can be embedded in the acoustic instrument itself.  2.RELATED WORK There are interesting projects using hidden or disguised loudspeakers to play electronic sounds, blending with the acoustic instrument sound in an organic way. However, there are two other main principles that relates to developing the FLAPIBox: Self-resonating vibrotactile instruments and Augmented Instruments. Eldridge et. al’s paper from 2021 [1] presents a thorough overview, and explains in detail the technical aspects of SRIs. The 20 projects described in the paper provide good background information for the physical design of the FLAPIBox. There are more works reviewing and explaining concepts related to Augmented instruments2 [2] [3] [4] which provide valuable information concerning the development of the internal circuit and software for the FLAPIBox  «Self-resonating vibrotactile instruments (SRIs) are hybrid feedback instruments, characterized by an electro-mechanical feedback loop that is both the means of sound production and the expressive interface.» [1]  The Halldorophone [5] is a cello-like string instrument where the feedback loop is created between string pick-ups and a loudspeaker mounted in the rear. Thranophone [6] is a device that can be applied to any brass instrument to create a feedback loop between a microphone in the players mouth and a loudspeaker placed in the bell of the instrument. William Thomson/Edgar Berdahl [7] and Andrew McPherson [8] have developed feedback augmentation for acoustic piano. Both projects apply computer processing abilities, and where Thompson/Berdahl use a soundboard-mounted exciter speaker, McPherson uses electromagnetic coils to make the piano strings sound. 
2 Also includes hyperinstruments, embedded instruments etc. 

 “Augmented instruments (…) are acoustic (sometimes electric) musical instruments extended by the addition of several sensors, providing performers to control extra sound or musical parameters.” [2] Most augmented instrument concepts focus on mapping sensor data and using these to control computer software for manipulating and enhancing the acoustic sound. Microphones and loudspeakers are usually not integrated and sound diffusion is dependent on a PA system, or similar. The MIGSI3 for Trumpet  [9] uses different sensors for collecting performance data that are transmitted to a computer. The Electrumpet [10] [11] and Hasgs4 [12] focus more on buttons, knobs and other haptic sensors. All three concepts use dedicated computer software on a laptop for processing sound.  3.INSTRUMENT DESIGN Whether the microphone and loudspeakers are external or integrated, the signal path is the same, meaning it is possible to combine both principals in a fully integrated concept. An augmented instrument with integrated loudspeaker is predicted to work better in acoustic settings and in interaction with purely acoustic instruments.  The FLAPIBox can make use of an array of different microphones or pickups, depending on which instrument is being augmented. Electret microphones [6], piezo elements [13] (or other types of contact microphones), single string pickups [14] or tailor-made pickup systems like PiezoBarrel5 [15] or Helpinstill6 [16] have been used in related works. Most SRIs use either normal loudspeakers or sound exciters7. The latter are mostly associated with string instruments and idiophones, utilizing the resonance box [7] [16] [14] while a normal loudspeaker is the best choice for brass instruments [5] [6]. Although woodwind instruments seems a bit complicated, it is possible  to create a feedback-loop under high enough volumes with a loudspeaker, attached  to the bell [15]. For the FLAPIBox both these types of loudspeakers are suitable.  3.1.Preliminary study - MBT The starting point of developing the FLAPIBox hardware was an early version of the Thranophone [6], consisting of an electret microphone, a pre amplifier, a power amplifier and a secondhand car speaker. It was powered by eight AA batteries and had quite a lot of internal noise due to ground issues and bad soldering. It also lacked the possibility of adding effects to the sound signal. However, it worked and proved the concept of an SRI.  
 Figure 1. Module based Thranophone (MBT) with Bronze/PLA mouthpiece.  3 Minimally Invasive Gesture Sensing Interface 4 Hybrid Augmented Saxophone of Gestural Symbioses 5 https://piezobarrel.com 
For better understanding the instrument, A more flexible, module based Thranophone (MBT) that resembled the pedal setup of a guitarist, was built (figure 1). The aim was to document differences when altering components more easily in the setup and to make a more predictable SRI.  The first issue needing improvement was the use of an electret microphone, placed in the player’s mouth [6]. Being ideal for changing the timbre of the sound, this microphone setup is however, somewhat unpredictable. Though it can be considered a strength for improvisers, it might be a challenge when composing a piece. The solution was to use a piezo element glued to the mouthpiece (1) that was fed into a suitable preamplifier (2). Both existing and 3D-printed mouthpieces was tested and resulted in better control of the feedback. However, some high frequencies were accentuated and even if some of these disappeared when choosing a low frequency loudspeaker, adding a filter, or a preamplifier (2) with built-in equalizer, would control these frequencies even better. Another issue was to be able to add effects or sound processing abilities. This was solved by adding a generic loop switch (3) and effect modules (4) or a computer for further processing of the sound source. The loop switch was connected to a power amplifier (5) with a connected loudspeaker (5). All components were running on separate power supplies or batteries.  Although the MBT is both technically stable and flexible, the goal is in the end to design and build an integrated unit with embedded buttons and sliders for controlling an internal minicomputer. The FLAPIBox will also have connectors for hardware peripherals such as microphones, loudspeakers, foot pedals, and later also different sensors. 3.2.FLAPIBox – Breadboard Prototype The next development stage was to build a breadboard prototype (Figure 3). The main purpose has been to design an integrated circuit, but still have the option of replacing components along the way. 
 Figure 2. FLAPIBox breadboard prototype. A microphone (1) or pickup is connected to an AD8288 preamplifier (2) via a 10K linear potentiometer for gain control. The preamplifier works with dynamic and piezo microphones. 
6 https://helpinstill.com/ 7 Also referred to as sound shakers, bass shakers etc. 8 https://www.wish.com/product/61966870c6288f8d848e4c11 

On the same breadboard there is also an MT36089 DC-DC Boost Converter (3) for powering the preamplifier (5V) and power amplifier (7) (9,5V). The signal continues via a generic soundcard (4) to a Raspberry Pi 4b10 (5), powered by USB. For this prototype the computer is running a RNBO patch and a Python script for controlling the RNBO patch with knobs and buttons. On the large breadboard (6) there are two circuits that separately control parameters in the RNBO patch via Python scripts. The left circuit has four 10K linear potentiometer and an MCP300811 ADC microchip. The circuit on the right has four continuous rotary encoders.  Both circuits are on the breadboard for comparison tests. The signal out (5 to 4) continues to a XH-M190 2x100W power amplifier (7) with volume control (potentiometer). The amplifier has the same specifications as the one Proto-Langspil uses (XH-M189) [14] and should fit most loudspeakers and instruments. At the end of the signal path a loudspeaker (8) is connected.  4.COMPUTERS AND SOFTWARE Where the MBT uses a MacBook Pro with a generic soundcard, controlled by generic MIDI controllers, the FLAPIBox has a built-in minicomputer for programming. Looking at related works, there are several options to choose from: BeagleBone is a platform of embedded computers that also serve as a microcontroller. Both the PocketBeagle12 and the Bela Mini13 are built on this platform. Proto-Langspil [14] houses a Bela Mini, and the PocketBeagle is being utilized by the Electrumpet [10]. For the FLAPIBox breadboard prototype a Raspberry Pi was used. Being more versatile and powerful, it is also an inexpensive alternative that has been used by augmented instruments for years [17]. Both MIGSI [9] and HASGS [12] use an Arduino14  microcontroller for mapping sensor data, though these are wirelessly transferred to an external computer. Adding a microcontroller to the FLAPIBox is still under considered but for the breadboard prototype it was not needed.  
 Figure 3. Software modules example in Max/MSP  Developing the software for the FLAPIBox and the MBT, the same modular approach as with developing the hardware is applied. A good reason for this is to keep the software more flexible and to easily be able to add more, replace or reuse modules according to instrumental and compositional needs. These modules have universal settings and layout for easy assemblage (Figure 5) and a library is available in the project’s repository. Until now Max/MSP15 has been the programming software and when RNBO16, a library for Max/MSP, was recently released, it was convenient to continue programming for  9 https://www.wish.com/product/5f447cdd5ae87102885f2832 10 https://www.raspberrypi.com 11 https://www.adafruit.com/product/856 12 https://beagleboard.org/pocket 13 https://bela.io/ 14 https://www.arduino.cc/ 
the breadboard prototype in this environment.  However, having an open-source approach, using a proprietary software goes against this principle. Further programming will therefor use free, platform independent programming software.   5.DISCUSSION Through reviewing related works, building two prototypes, a module-based and an integrated breadboard prototype, the early development stages of a novel, flexible augmented instrument design has been presented. The FLAPIBox is a valuable contribution to the field of augmented instruments and from a composer’s point of view, a modular, widely adaptable concept like this, is a new way of expanding compositions with electronic sound. Due to its open-source approach and cross-instrumental properties, the FLAPIBox is easily accessible, and prepared for further development. And finally, it provides a good, alternative way to diffuse acoustic and electronic sound, which was also an issue addressed in the development of the HypeSax: “(New interfaces) (…) rely on external speakers or similar transducers. This often results in disembodiment and acoustic disengagement from the interface; and, in the case of augmented instruments, from the instruments themselves.  [18]” Musical instrument augmentation with integrated microphones and loudspeaker already exists. The Feedback-augmented alto clarinet [15], the Proto-Langspil [14] and the HypeSax [18] are all hybrids between SRIs and Augmented instruments, but lacks the same cross-instrumental properties as the FLAPIBox does. However, future HypeSax versions for other instruments was proposed, but not yet built. Apart from the Proto- Langspil, an external computer is required for sound processing and sensor data mapping, which makes the FLAPIBox a fully integrated option that fills a gap in the research field of augmented instruments. Building the breadboard prototype have shown that an integrated circuit can work satisfactorily. However, there are some minor issues to be addressed: Originally the circuit was supposed to get voltage from the GPIO-pins of the computer, but because of processor noise a second power source was needed. Both potentiometers and continuous rotary encoders for controlling the software patch was tested with the result of the encoders being more stable. Using a Raspberry Pi 4b as computer for the breadboard prototype was a bit arbitrary and might also be a more powerful computer than the FLAPIBox needs. However, determining the most suitable computer is yet to be decided. Latency, price, cpu-speed, amount, and type of connectors are issues that need consideration.  For the MBT, Ableton LIVE17 is a satisfactory DAW software that serves most needs but requires an external computer and soundcard. For minicomputers there are several options of programming software, all of which are even more adaptable, and can be run on an external computer as well. SuperCollider18 is used for the Proto-Langspil [14] and is compatible with Bela. Pure Data19 is an open-source version of Max/MSP and would be the most accessible choice for the FLAPIBox because of its compatibility with any computer running GNU/Linux. Since the software development started in Max/MSP, a transition to Pure Data would make the FLAPIBox more accessible and maintain the freedom of choosing a computer. 
15 https://cycling74.com/products/max 16 https://cycling74.com/products/rnbo 17 https://www.ableton.com/en/live/ 18 https://supercollider.github.io/ 19 https://puredata.info/ 

6.FUTURE WORK The further development of the FLAPIBox is to build a soldered, boxed prototype with an LCD-display for visual feedback and with all connectors for power, microphones and loudspeakers. It is yet to decide which computer and soundcard to use, how to best handle electrical power distribution and to find a good way to flexibly handle dynamic, piezo and electret microphones. Which types of buttons/sliders to embed and which peripheral connectors should be added in the future also need investigation. Some of these questions are best answered through further software development, which also depends on compositional desires. At the time of writing, the software patches mostly collect performance data such as pitch and amplitude to control events, which requires few buttons/sliders. Later compositions might require more controllable parameters via buttons/sliders and/or different types of sensors. The decision on a definitive hardware design will be made after several compositions have been made.  The author is composing pieces for acoustic instruments being augmented by the FLAPIBox. The first one for bass flute and a newly developed speaker mounted in the foot joint. A piano piece utilizing the Helpinstill pick-up system and pieces for combinations of wind instruments, making use of BarcusBerry,20 PiezoBarrel and intraMic21 are also planned. These compositions will partly determine technical choices in further development of the FLAPIBox. 7.CONCLUSIONS This paper presents the early-stage development of the FLAPIBox, a programmable, flexible musical instrument augmentation. The development suggests a hardware design where different types of microphones and loudspeakers are embeddable in the instrument itself. Being a fully integrated solution adaptable to most acoustic instruments, The FLAPIBox is a valuable contribution to the research field of augmented instruments. 8.ETHICAL STANDARDS This paper is a part of a PhD degree in artistic research at The University of Bergen, Faculty of Fine Art, Music and Design and is funded by The Norwegian Artistic Research Program. The author is employed as a Doctoral Research Fellow at UiT The Arctic University of Norway, Academy of Music, Tromsø for the duration of the PhD studies.  All research associated with this paper follow all required ethical standards of the employer and educating institutions. All results will be made available as open source upon publishing this paper. Technical details, parts list, electrical schematics and software patches will be available in the project’s repository.   The FLAPIBox is replicable with low-cost hardware parts. The software required is free and platform independent (FLOSH). The software patches made in Max/MSP, RNBO will be replicated in a free software alternative.     9.REFERENCES [1] A. Eldridge, C. Kiefer, D. Overholt, and H. Ulfarsson, “Self-resonating Vibrotactile Feedback Instruments ||: Making, Playing, Conceptualising :||,” in International Conference on New Interfaces for Musical Expression, Jun. 2021.  [2] E. R. Miranda and M. M. Wanderley, New Digital Musical Instruments: Control and Interaction Beyond the Keyboard. A-R Editions, Inc., 2006.  20 https://www.fullcompass.com/prod/120324-barcus-berry-6100m-flute-mic-with-cork-assembly-preamp-sold-separately 
[3] A. R. Jensenius and M. J. Lyons, Eds., A NIME Reader, vol. 3. in Current Research in Systematic Musicology, vol. 3. Cham: Springer International Publishing, 2017.  [4] S. Reid, S. Sithi-Amnuai, and A. Kapur, “Women Who Build Things: Gestural Controllers, Augmented Instruments, and Musical Mechatronics,” in Proceedings of the International Conference on New Interfaces for Musical Expression, Zenodo, Blacksburg, Virginia, USA, Jun. 01, 2018, pp. 178–183.  [5] H. Úlfarsson, “The halldorophone: The ongoing innovation of a cello-like drone instrument,” in Proceedings of the International Conference on New Interfaces for Musical Expression, Zenodo, Blacksburg, Virginia, USA, Jun. 01, 2018, pp. 269–274.  [6] Þ. Hjálmarsson, “Þráinn Hjálmarsson, composer.” http://thrainnhjalmarsson.info/ (accessed Jan. 16, 2023). [7] W. Thompson and E. Berdahl, “An Infinitely Sustaining Piano Achieved Through a Soundboard-Mounted Shaker,” in International Conference on New Interfaces for Musical Expression, Apr. 2021.  [8] A. McPherson, “The Magnetic Resonator Piano: Electronic Augmentation of an Acoustic Grand Piano,” J. New Music Res., vol. 39, no. 3, pp. 189–202, Sep. 2010. [9] S. Reid, R. Gaston, C. Honigman, and A. Kapur, “Minimally Invasive Gesture Sensing Interface (MIGSI) for Trumpet,” in Proceedings of the International Conference on New Interfaces for Musical Expression, Zenodo, Brisbane, Australia, Jun. 01, 2016, pp. 419–424.  [10] H. Leeuw, “Designing expressive engagement with electronic and hyper instruments.The Electrumpet a case study,” doctoral, University of Huddersfield, 2019. Accessed: Jan. 16, 2023. [Online]. Available: https://www.hud.ac.uk/news/ [11] H. Leeuw, “Virtuoso mapping for the Electrumpet, a hyperinstrument strategy,” in International Conference on New Interfaces for Musical Expression, Apr. 2021.  [12] H. Portovedo, P. F. Lopes, R. Mendes, and T. Gala, “HASGS: Five Years of Reduced Augmented Evolution,” in International Conference on New Interfaces for Musical Expression, Apr. 2021.  [13] K. T. Møster, “Playing the Electrophonic Saxophone,” doctoral, The Grieg Academy, Faculty of Fine Arts, Music and Design, University of Bergen, 2021. Accessed: Jan. 16, 2023. [Online]. Available: https://www.researchcatalogue.net/view/1160461/1165430 [14] J. Armitage, T. Magnusson, V. Shepardson, and H. Ulfarsson, “The Proto-Langspil: Launching an Icelandic NIME Research Lab with the Help of a Marginalised Instrument,” presented at the NIME 2022, PubPub, Jun. 2022.  [15] S. Manousakis, “Feedback-augmented alto clarinet,” Stelios Manousakis. http://modularbrains.net/portfolio/feedback-augmented-alto-clarinet/ (accessed Jan. 16, 2023). [16] M. Qvenild, “The HyPer(sonal) Piano Project : towards a (per)sonal topography of grand piano and electronics [interactive pdf],” doctoral, The Norwegian Academy of 
21 https://www.horn-fx.com/intramic-article 
Music, 2016. Accessed: Jan. 16, 2023. [Online]. Available: https://nmh.brage.unit.no/nmh-xmlui/handle/11250/2425556 [17] E. Berdahl, “How to Make Embedded Acoustic Instruments,” in Proceedings of the International Conference on New Interfaces for Musical Expression (pp. 140–143), London, UK, London, UK, 2014. [18] C. R. Flores, J. Murphy, and M. Norris, “HypeSax: Saxophone acoustic augmentation,” in Proceedings of the International Conference on New Interfaces for Musical Expression, Zenodo, Porto Alegre, Brazil, Jun. 01, 2019, pp. 365–370. doi: 10.5281/zenodo.3672996.  